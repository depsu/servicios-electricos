---
import Layout from '../layouts/Layout.astro';
import QuickForm from '../components/QuickForm.astro';
import CallToAction from '../components/CallToAction.astro';
import TrustBar from '../components/TrustBar.astro';
import TechSpecsTable from '../components/TechSpecsTable.astro';
import ProcessTimeline from '../components/ProcessTimeline.astro';
import { siteConfig } from '../config/site';

interface Props {
  title: string;
  subtitle?: string;
  segment: 'industrial' | 'hogar';
  intro: string;
  benefits: string[];
  features?: string[];
  faq?: { question: string; answer: string }[];
  techSpecs?: { label: string; value: string }[];
  processSteps?: { title: string; desc: string }[];

  deliverables?: string[];
  testimonials?: { name: string; text: string; location: string; rating: number }[];
  gallery?: { url: string; caption: string }[];
  heroImageMobile?: string;
  heroImageDesktop?: string;
}

const { title, subtitle, segment, intro, benefits, features, faq, techSpecs, processSteps, deliverables, testimonials, gallery, heroImageMobile, heroImageDesktop } = Astro.props;

const isIndustrial = segment === 'industrial';
const themeColor = isIndustrial ? 'text-blue-600' : 'text-emerald-600';
const themeBg = isIndustrial ? 'bg-blue-50' : 'bg-emerald-50';
const btnColor = isIndustrial ? 'bg-blue-600 hover:bg-blue-700' : 'bg-emerald-500 hover:bg-emerald-600';
const whatsappUrl = `https://wa.me/${siteConfig.company.whatsapp}?text=Hola,%20me%20interesa%20el%20servicio%20de%20${encodeURIComponent(title)}.%20Necesito%20m√°s%20informaci√≥n.`;

const schema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": title,
  "description": intro,
  "provider": {
    "@type": "Electrician",
    "name": "Servicios El√©ctricos RM",
    "image": "https://chileelectrico.cl/images/logo.png",
    "areaServed": "Regi√≥n Metropolitana"
  },
  "serviceType": isIndustrial ? "Industrial Electrical Service" : "Residential Electrical Service",
  "offers": {
    "@type": "Offer",
    "availability": "https://schema.org/InStock",
    "priceCurrency": "CLP",
    "price": "0" // Price upon request
  }
};
---

<Layout title={`${title} | Servicios El√©ctricos RM`} description={intro} schema={schema}>
  <!-- Hero Section -->
  <section class="relative min-h-[600px] flex items-center overflow-hidden">
    
    <!-- Responsive Background Image Layer -->
    <div class="absolute inset-0 z-0 select-none">
        {heroImageMobile && heroImageDesktop ? (
            <picture>
                <source media="(max-width: 768px)" srcset={heroImageMobile} />
                <source media="(min-width: 769px)" srcset={heroImageDesktop} />
                <img src={heroImageDesktop} alt={title} class="w-full h-full object-cover object-center" fetchpriority="high" />
            </picture>
        ) : (
            // Fallback default background if no specific images
            <div class={`w-full h-full ${isIndustrial ? 'bg-slate-900' : 'bg-emerald-950'}`}></div>
        )}
        
        <!-- Gradient Overlay for Readability (Darker to lighter) -->
        <div class="absolute inset-0 bg-gradient-to-r from-slate-950/95 via-slate-900/80 to-slate-900/40"></div>
        
        <!-- Subtle Grid Pattern Overlay -->
        <div class="absolute inset-0 opacity-[0.07] bg-[url('/images/grid-pattern.svg')] mix-blend-overlay"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10 py-20 text-white">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        
        <!-- Hero Text -->
        <div class="max-w-2xl">
            <span class={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-4 border ${isIndustrial ? 'bg-blue-500/10 border-blue-400 text-blue-300' : 'bg-emerald-500/10 border-emerald-400 text-emerald-300'}`}>
              {isIndustrial ? '‚ö° SERVICIO INDUSTRIAL / B2B' : 'üè° SERVICIO HOGAR / RURAL'}
            </span>
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-6 leading-tight">
              {title}
            </h1>
            <p class="text-lg md:text-xl opacity-90 mb-8 leading-relaxed max-w-lg">
              {intro}
            </p>
            
            <div class="hidden md:flex flex-col gap-3 mb-8">
               <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0">
                    <span class="text-green-400 text-xl">‚úì</span>
                  </div>
                  <div>
                    <span class="font-bold block">Certificaci√≥n SEC</span>
                    <span class="text-xs opacity-70">Normativa vigente NCh4/2003</span>
                  </div>
               </div>
               <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0">
                    <span class="text-yellow-400 text-xl">‚òÖ</span>
                  </div>
                  <div>
                    <span class="font-bold block">Garant√≠a por Escrito</span>
                    <span class="text-xs opacity-70">Respaldo total en cada trabajo</span>
                  </div>
               </div>
            </div>

            <div class="flex flex-wrap gap-4 md:hidden">
              <a href={whatsappUrl} class={`px-8 py-3 rounded-xl font-bold shadow-lg text-center w-full flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white transition active:scale-95`}>
                <i class="fa-brands fa-whatsapp text-xl"></i>
                Cotiza Gratis por WhatsApp
              </a>
            </div>
        </div>

        <!-- Hero Form -->
        <div class="relative" id="cotizar-form">
          <QuickForm 
            title="Solicita Presupuesto o Visita T√©cnica"
            buttonText="Solicitar Evaluacion GRATIS"
            variant="glass-dark"
            class="shadow-2xl border-opacity-50"
          />
          <p class="text-xs text-center mt-3 opacity-60">
            <i class="fa-solid fa-lock mr-1"></i> Tus datos est√°n 100% seguros y no compartimos spam.
          </p>
        </div>

      </div>
    </div>
  </section>

  <TrustBar items={["Empresa Certificada SEC", "+500 Proyectos Ejecutados", "Garant√≠a Legal 12 Meses", "Atenci√≥n en Todo RM"]} />

  <!-- Trusted Industries Section (New) -->
  {isIndustrial && (
    <section class="py-12 bg-slate-50 border-b border-slate-200">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-slate-500 font-bold uppercase tracking-widest text-sm mb-8">Experiencia Multisectorial</h3>
        <div class="flex flex-wrap justify-center items-center gap-8 md:gap-16 opacity-60 grayscale hover:grayscale-0 transition-all duration-500">
            <!-- Placeholders for logos -->
            <div class="flex flex-col items-center gap-2 group">
                <i class="fa-solid fa-industry text-4xl text-slate-700 group-hover:text-blue-600 transition"></i>
                <span class="text-xs font-bold text-slate-400">Manufactura</span>
            </div>
            <div class="flex flex-col items-center gap-2 group">
                <i class="fa-solid fa-warehouse text-4xl text-slate-700 group-hover:text-blue-600 transition"></i>
                <span class="text-xs font-bold text-slate-400">Log√≠stica</span>
            </div>
            <div class="flex flex-col items-center gap-2 group">
                <i class="fa-solid fa-building text-4xl text-slate-700 group-hover:text-blue-600 transition"></i>
                <span class="text-xs font-bold text-slate-400">Corporativo</span>
            </div>
            <div class="flex flex-col items-center gap-2 group">
                <i class="fa-solid fa-hospital text-4xl text-slate-700 group-hover:text-blue-600 transition"></i>
                <span class="text-xs font-bold text-slate-400">Salud</span>
            </div>
             <div class="flex flex-col items-center gap-2 group">
                <i class="fa-solid fa-cart-shopping text-4xl text-slate-700 group-hover:text-blue-600 transition"></i>
                <span class="text-xs font-bold text-slate-400">Retail</span>
            </div>
        </div>
      </div>
    </section>
  )}

  <section id="detalles" class="py-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-2 gap-12 items-start">
        
        <!-- Benefits / Intro -->
        <div>
          <h2 class="text-3xl font-bold text-slate-900 mb-6">Descripci√≥n del Servicio</h2>
          <div class="prose prose-lg text-slate-600 mb-8">
            <p>{intro}</p>
          </div>
          
          <h3 class="text-xl font-bold text-slate-900 mb-4">Beneficios Clave</h3>
          <ul class="space-y-4">
            {benefits.map(benefit => (
              <li class="flex items-start gap-3">
                <span class={`w-6 h-6 rounded-full flex-shrink-0 flex items-center justify-center text-white text-xs ${isIndustrial ? 'bg-blue-600' : 'bg-emerald-600'}`}>‚úì</span>
                <span class="text-slate-700">{benefit}</span>
              </li>
            ))}
          </ul>
        </div>

        <!-- Features card -->
        <div class={`p-8 rounded-2xl ${themeBg}`}>
          <h3 class={`text-2xl font-bold mb-6 ${themeColor}`}>
            {isIndustrial ? 'Especificaciones T√©cnicas' : 'Lo que incluye el servicio'}
          </h3>
          
          <div class="space-y-4">
            {(features || []).map(feature => (
              <div class="flex items-center gap-3 bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                <span class="text-xl">‚ö°</span>
                <span class="font-medium text-slate-800">{feature}</span>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  </section>

  {techSpecs && techSpecs.length > 0 && (
    <section class="py-12 bg-white">
      <div class="container mx-auto px-4 max-w-4xl">
         <TechSpecsTable specs={techSpecs} />
      </div>
    </section>
  )}

  <ProcessTimeline steps={processSteps} segment={segment} />

  {/* Gallery Section */}
  {gallery && gallery.length > 0 && (
    <section class="py-20 bg-slate-900 text-white">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">Galer√≠a de Proyectos</h2>
        <div class="grid md:grid-cols-3 gap-6">
           {gallery.map(img => (
             <div class="group relative overflow-hidden rounded-xl aspect-video bg-slate-800">
               <img src={img.url} alt={img.caption} class="w-full h-full object-cover transition duration-500 group-hover:scale-110 opacity-70 group-hover:opacity-100" />
               <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                 <p class="text-white font-medium text-sm">{img.caption}</p>
               </div>
             </div>
           ))}
        </div>
      </div>
    </section>
  )}

  {/* Testimonials Section */}
  {testimonials && testimonials.length > 0 && (
      <section class="py-20 bg-slate-50 border-t border-slate-200">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-slate-900">Lo que dicen nuestros clientes</h2>
            <div class="grid md:grid-cols-3 gap-8">
                {testimonials.map(t => (
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-100 relative">
                        <div class="text-yellow-400 text-xl mb-4">
                            {"‚òÖ".repeat(t.rating)}
                        </div>
                        <p class="text-slate-600 italic mb-6">"{t.text}"</p>
                        <div class="flex items-center gap-3">
                            <div class={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${isIndustrial ? 'bg-blue-600' : 'bg-emerald-600'}`}>
                                {t.name.charAt(0)}
                            </div>
                            <div>
                                <p class="font-bold text-slate-900 text-sm">{t.name}</p>
                                <p class="text-xs text-slate-400">{t.location}</p>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
      </section>
  )}

  {/* Deliverables Section */}
  {deliverables && deliverables.length > 0 && (
      <section class="py-20 bg-slate-50">
      <div class="container mx-auto px-4">
          <h2 class="text-3xl font-bold text-center mb-12 text-slate-900">Entregables del Servicio</h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {deliverables.map((item, index) => (
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex items-center gap-4">
                    <div class={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shrink-0 ${isIndustrial ? 'bg-blue-600' : 'bg-emerald-600'}`}>
                        {index + 1}
                    </div>
                    <p class="font-medium text-slate-700">{item}</p>
                </div>
            ))}
          </div>
      </div>
      </section>
  )}

  <!-- Comparison Section (New) -->
  <section class="py-20 bg-white border-t border-slate-100">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-slate-900">¬øPor qu√© elegirnos?</h2>
            <p class="text-slate-600 mt-2">La diferencia entre un trabajo y una soluci√≥n profesional.</p>
        </div>

        <div class="overflow-x-auto pt-6">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr>
                        <th class="p-4 bg-slate-50 border-b-2 border-slate-200 text-slate-500 font-medium w-1/3">Caracter√≠sticas</th>
                        <th class={`p-4 ${isIndustrial ? 'bg-blue-50 border-blue-200 text-blue-800' : 'bg-emerald-50 border-emerald-200 text-emerald-800'} border-b-2 font-bold text-center w-1/3 rounded-t-lg relative`}>
                           <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-400 text-slate-900 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wider">Recomendado</span>
                           Servicios El√©ctricos RM
                        </th>
                        <th class="p-4 bg-slate-50 border-b-2 border-slate-200 text-slate-500 font-medium text-center w-1/3">T√©cnico Informal</th>
                    </tr>
                </thead>
                <tbody class="text-sm">
                    <tr class="border-b border-slate-100">
                        <td class="p-4 font-semibold text-slate-700">Certificaci√≥n SEC</td>
                        <td class="p-4 text-center font-bold text-green-600"><i class="fa-solid fa-check-circle mr-1"></i> SI, AL D√çA</td>
                        <td class="p-4 text-center text-slate-400"><i class="fa-solid fa-circle-question mr-1"></i> Dudoso</td>
                    </tr>
                    <tr class="border-b border-slate-100 bg-slate-50/50">
                        <td class="p-4 font-semibold text-slate-700">Garant√≠a por Escrito</td>
                        <td class="p-4 text-center font-bold text-green-600">12 MESES</td>
                        <td class="p-4 text-center text-slate-400">Verbal / Ninguna</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="p-4 font-semibold text-slate-700">Facturaci√≥n</td>
                        <td class="p-4 text-center font-bold text-green-600">FACTURA / BOLETA</td>
                        <td class="p-4 text-center text-slate-400">Solo Efectivo</td>
                    </tr>
                    <tr class="border-b border-slate-100 bg-slate-50/50">
                        <td class="p-4 font-semibold text-slate-700">Tiempos de Entrega</td>
                        <td class="p-4 text-center font-bold text-green-600">GARANTIZADOS</td>
                        <td class="p-4 text-center text-slate-400">Inciertos</td>
                    </tr>
                    <tr>
                         <td class="p-4 font-semibold text-slate-700">Herramientas Normadas</td>
                        <td class="p-4 text-center font-bold text-green-600"><i class="fa-solid fa-check mr-1"></i> SI (Calibradas)</td>
                        <td class="p-4 text-center text-slate-400">B√°sicas</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
  </section>

  {faq && faq.length > 0 && (
    <section class="py-20 bg-white">
      <div class="container mx-auto px-4 max-w-3xl">
        <h2 class="text-3xl font-bold text-center text-slate-900 mb-12">Preguntas Frecuentes</h2>
        <div class="space-y-4">
          {faq.map(item => (
            <div class="bg-white rounded-xl shadow-sm p-6">
              <h3 class="font-bold text-slate-900 mb-2 text-lg">{item.question}</h3>
              <p class="text-slate-600">{item.answer}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <CallToAction 
    title="¬øNecesitas este servicio?" 
    subtitle="Cont√°ctanos para una evaluaci√≥n gratuita o presupuesto inmediato."
    ctaText="Conversar con Especialista"
    ctaLink={`/cotizar?tipo=${segment === 'industrial' ? 'empresa' : 'hogar'}&servicio=${Astro.url.pathname.split('/').pop()}`}
  />
</Layout>
