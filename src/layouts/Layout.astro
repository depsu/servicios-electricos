---
import '../styles/global.css';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import WhatsAppFloat from '../components/WhatsAppFloat.astro';
import StickyCTA from '../components/StickyCTA.astro';
import { siteConfig } from '../config/site';

interface Props {
	title: string;
    description?: string;
    image?: string;
    schema?: object;
    regionText?: string;
}

const { title, description = "Servicios eléctricos profesionales en Región Metropolitana. Industrial y Domiciliario.", image = "/images/og-default.jpg", schema, regionText = "Región Metropolitana" } = Astro.props;
const { font } = siteConfig.theme;

// Map fonts to Google Fonts URLs and Tailwind classes
const fontConfig = {
    sans: {
        url: 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap',
        family: 'font-sans' // Tailwind default sans (Inter/System)
    },
    serif: {
        url: 'https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap',
        family: 'font-serif'
    },
    mono: {
        url: 'https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap',
        family: 'font-mono'
    }
};

const currentFont = fontConfig[font] || fontConfig.sans;

import { ClientRouter } from 'astro:transitions';
---

<!doctype html>
<html lang="es" class="scroll-smooth">
	<head>
		<!-- Google Tag Manager -->
		<script is:inline>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-NQ44WHJ3');</script>
		<!-- End Google Tag Manager test -->
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>

        <!-- Canonical URL -->
        <link rel="canonical" href={Astro.url.href} />

        <!-- Robots -->
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />

        <!-- Geo Meta Tags (Chile) -->
        <meta name="geo.region" content="CL-RM" />
        <meta name="geo.placename" content="Santiago, Región Metropolitana" />
        <meta name="geo.position" content="-33.4489;-70.6693" />
        <meta name="ICBM" content="-33.4489, -70.6693" />

        <!-- Author & Publisher -->
        <meta name="author" content="Servicios Eléctricos RM" />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={Astro.url} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={new URL(image, Astro.url)} />
        <meta property="og:locale" content="es_CL" />
        <meta property="og:site_name" content="Servicios Eléctricos RM" />

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content={Astro.url} />
        <meta property="twitter:title" content={title} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:image" content={new URL(image, Astro.url)} />
        
        <!-- Page-specific Schema -->
        {schema && (
            <script type="application/ld+json" set:html={JSON.stringify(schema)} />
        )}

        <!-- Global LocalBusiness Schema -->
        <script type="application/ld+json" set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "Electrician",
            "name": "Servicios Eléctricos RM",
            "description": "Servicios eléctricos industriales y domiciliarios en la Región Metropolitana. Tableros eléctricos, empalmes rurales, gasfitería y más.",
            "url": "https://chileelectrico.cl",
            "telephone": "+56912345678",
            "email": "contacto@chileelectrico.cl",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "Santiago",
                "addressRegion": "Región Metropolitana",
                "addressCountry": "CL"
            },
            "geo": {
                "@type": "GeoCoordinates",
                "latitude": -33.4489,
                "longitude": -70.6693
            },
            "areaServed": [
                { "@type": "City", "name": "Lampa" },
                { "@type": "City", "name": "Pudahuel" },
                { "@type": "City", "name": "San Bernardo" },
                { "@type": "City", "name": "Chicureo" },
                { "@type": "City", "name": "Buin" },
                { "@type": "City", "name": "Melipilla" }
            ],
            "priceRange": "$$",
            "openingHoursSpecification": {
                "@type": "OpeningHoursSpecification",
                "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                "opens": "08:00",
                "closes": "20:00"
            },
            "sameAs": []
        })} />
        
        <!-- Dynamic Font Loading -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href={currentFont.url} rel="stylesheet">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <ClientRouter />
	</head>
	<body class={`bg-slate-50 antialiased pb-24 md:pb-0 pt-20 md:pt-24 ${currentFont.family}`}>
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NQ44WHJ3"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) test -->
        <Navbar>{regionText}</Navbar>
		<slot />
        <Footer />
        <WhatsAppFloat transition:persist />
        <StickyCTA transition:persist />
	</body>
</html>
